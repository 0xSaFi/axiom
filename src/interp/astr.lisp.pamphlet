\documentclass{article}
\usepackage{axiom}
\begin{document}
\title{\$SPAD/src/interp astr.lisp}
\author{The Axiom Team}
\maketitle
\begin{abstract}
\end{abstract}
\eject
\tableofcontents
\eject
<<*>>=

(IN-PACKAGE "BOOT")

;--% Attributed Structures (astr)
;-- For objects which are pairs where the CAR field is either just a tag
;-- (an identifier) or a pair which is the tag and an association list.
; 
;-- Pick off the tag
;ncTag x ==
;   not PAIRP x => ncBug('S2CB0031,[])
;   x := QCAR x
;   IDENTP x => x
;   not PAIRP x => ncBug('S2CB0031,[])
;   QCAR x
 

(DEFUN |ncTag| (|x|)
 (PROG NIL
  (RETURN
   (COND
    ((NULL (CONSP |x|))
     (|ncBug| (QUOTE S2CB0031) NIL))
    (#0=(QUOTE T)
     (PROGN
      (SETQ |x| (QCAR |x|))
      (COND
       ((IDENTP |x|) |x|)
       ((NULL (CONSP |x|)) (|ncBug| (QUOTE S2CB0031) NIL))
       (#0# (QCAR |x|)))))))))


;-- Pick off the property list
;ncAlist x ==
;   not PAIRP x => ncBug('S2CB0031,[])
;   x := QCAR x
;   IDENTP x => NIL
;   not PAIRP x => ncBug('S2CB0031,[])
;   QCDR x

(DEFUN |ncAlist| (|x|)
 (PROG NIL
  (RETURN
   (COND
    ((NULL (CONSP |x|)) (|ncBug| (QUOTE S2CB0031) NIL))
    (#0=(QUOTE T)
     (PROGN
      (SETQ |x| (QCAR |x|))
      (COND
       ((IDENTP |x|) NIL)
       ((NULL (CONSP |x|)) (|ncBug| (QUOTE S2CB0031) NIL))
       (#0# (QCDR |x|)))))))))

;--- Get the entry for key k on x's association list
;ncEltQ(x,k) ==
;   r := QASSQ(k,ncAlist x)
;   NULL r => ncBug ('S2CB0007,[k])
;   CDR r

(DEFUN |ncEltQ| (|x| |k|)
 (PROG (|r|)
  (RETURN
   (PROGN
    (SETQ |r| (QASSQ |k| (|ncAlist| |x|)))
    (COND
     ((NULL |r|) (|ncBug| (QUOTE S2CB0007) (LIST |k|)))
     ((QUOTE T) (CDR |r|)))))))
 
;-- Put (k . v) on the association list of x and return v
;-- case1: ncPutQ(x,k,v) where k is a key (an identifier), v a value
;--        put the pair (k . v) on the association list of x and return v
;-- case2: ncPutQ(x,k,v) where k is a list of keys, v a list of values
;--        equivalent to [ncPutQ(x,key,val) for key in k for val in v]
;ncPutQ(x,k,v) ==
;   LISTP k =>
;      for key in k for val in v repeat ncPutQ(x,key,val)
;      v
;   r := QASSQ(k,ncAlist x)
;   if NULL r then
;      r := CONS( CONS(k,v), ncAlist x)
;      RPLACA(x,CONS(ncTag x,r))
;   else
;      RPLACD(r,v)
;   v
 
(DEFUN |ncPutQ| (|x| |k| |v|)
 (PROG (|r|)
  (RETURN
   (COND
    ((LISTP |k|)
     (PROGN
      ((LAMBDA (|bfVar#1| |key| |bfVar#2| |val|)
        (LOOP
         (COND
           ((OR (ATOM |bfVar#1|)
                (PROGN (SETQ |key| (CAR |bfVar#1|)) NIL)
                (ATOM |bfVar#2|)
                (PROGN (SETQ |val| (CAR |bfVar#2|)) NIL))
             (RETURN NIL))
           ((QUOTE T) 
             (|ncPutQ| |x| |key| |val|)))
         (SETQ |bfVar#1| (CDR |bfVar#1|))
         (SETQ |bfVar#2| (CDR |bfVar#2|))))
       |k| NIL |v| NIL)
      |v|))
    ((QUOTE T)
     (PROGN
      (SETQ |r| (QASSQ |k| (|ncAlist| |x|)))
      (COND
       ((NULL |r|)
         (SETQ |r| (CONS (CONS |k| |v|) (|ncAlist| |x|)))
         (RPLACA |x| (CONS (|ncTag| |x|) |r|)))
       ((QUOTE T) (RPLACD |r| |v|)))
      |v|))))))

@
\eject
\begin{thebibliography}{99}
\bibitem{1} nothing
\end{thebibliography}
\end{document}
